<p id="topic-content"><h1 id="jd0e2">Using the Wireshark Plugin to Analyze Packets Between vRouter
and vRouter Agent on pkt0 Interface</h1><sw-topic-details date="2020-12-04"> </sw-topic-details><p>Wireshark is a an application that analyzes packets from
a network and displays the packet information in detail. </p><p><span id="jd0e12">Contrail Networking Release
2008 and later supports the Wireshark <code class="filepath">agent_header.lua</code> plugin, which enables you to capture and analyze the packets exchanged
between a vRouter data plane and vRouter agent.</span> You can capture the packets by executing the <span class="cli" v-pre="">vifdump -i 2</span> and the <span class="cli" v-pre="">tcpdump -i pkt0</span> commands in DPDK mode and kernel
mode respectively. In release 2008, the Wireshark agent_header.lua plugin is supported
on Macintosh OS computers only. .<span id="jd0e24">Starting from release 2011, the Wireshark <code class="filepath">agent_header.lua</code> plugin is supported on Macintosh
OS as well as Windows OS computers.</span> Wireshark
also enables you to add  agent header information to the captured
packets.</p><p> </p><p><kbd class="user-typing" v-pre="">Before you begin</kbd></p><p>You must ensure that the Wireshark application is installed
on your computer. You can download Wireshark from the <a href="https://www.wireshark.org/#download">Download Wireshark</a> page.</p><p><kbd class="user-typing" v-pre="">Configuration</kbd></p><p>Follow these steps to configure the Wireshark plugin and dissect agent header information
in a packet:</p><ol type="1"><li id="jd0e49" style="">Download the Wireshark plugin from  GitHub: <a href="https://github.com/tungstenfabric/tf-vrouter/tree/master/utils/agent_hdr_plugin">https://github.com/tungstenfabric/tf-vrouter/tree/master/utils/agent_hdr_plugin</a>.</li><li id="jd0e55" style="">Copy the plugin in to the following Wireshark directory
on your Macintosh OS computer: <code class="filepath">/Applications/Wireshark.app/Contents/PlugIns/wireshark/</code>.</li><li id="jd0e61" style="">Verify that the <code class="filepath">agent_hdr.lua</code> plugin is loaded successfully in Wireshark. Relaunch Wireshark and
navigate to <strong v-pre="">Wireshark</strong> &gt; <strong v-pre="">About Wireshark</strong> &gt; <strong v-pre="">Plugins</strong> to verify that the plugin is loaded in the <strong v-pre="">Plugins</strong> section. See <a href="adding-agent-header-using-wireshark-plugin.html#agent-hdr-plugin-loaded">Figure 1</a>.<figure id="agent-hdr-plugin-loaded"><figcaption>Figure 1: The Plugin is Loaded in
Wireshark</figcaption><div class="graphic"><img alt="The Plugin is Loaded in
Wireshark" src="documentation/images/s060265.png" style=""/></div></figure></li><li id="step-four" style="">Pass the pcap file through editcap to add
a custom encapsulation type for a packet:<p><code class="inline" v-pre="">editcap -T user0 &lt;pcap-file-to-be-read&gt; &lt;output.pcap&gt;</code></p></li><li id="jd0e91" style="">In Wireshark, navigate to <strong v-pre="">Wireshark</strong> &gt; <strong v-pre="">Preferences</strong> &gt; <strong v-pre="">Protocols</strong> &gt; <strong v-pre="">DLT_USER</strong> &gt; <strong v-pre="">Edit Encapsulation Table</strong>. See <a href="adding-agent-header-using-wireshark-plugin.html#encapsulation-table">Figure 2</a>.<figure id="encapsulation-table"><figcaption>Figure 2: Edit Encapsulation Table</figcaption><div class="graphic"><img alt="Edit Encapsulation Table" src="documentation/images/s060266.png" style=""/></div></figure></li><li id="jd0e115" style="">In the <strong v-pre="">Edit Encapsulation Table</strong>, add the <code class="inline" v-pre="">agent_hdr</code> as a payload protocol for the packet. See <a href="adding-agent-header-using-wireshark-plugin.html#add-agent-hdr">Figure 3</a>.<figure id="add-agent-hdr"><figcaption>Figure 3: Add Agent Header to a Packet</figcaption><div class="graphic"><img alt="Add Agent Header to a Packet" src="documentation/images/s060267.png" style=""/></div></figure></li><li id="jd0e130" style="">Using Wireshark, open the modified pcap file you generated
in step <a href="adding-agent-header-using-wireshark-plugin.html#step-four">4</a>. Wireshark displays
the parsed packets. See <a href="adding-agent-header-using-wireshark-plugin.html#modified-parsed-packets">Figure 4</a>.<figure id="modified-parsed-packets"><figcaption>Figure 4: Packets Expanded Using
the Wireshark Plugin</figcaption><div class="graphic"><img alt="Packets Expanded Using
the Wireshark Plugin" src="documentation/images/s060268.png" style=""/></div></figure></li></ol><p>Follow these steps to configure the Wireshark plugin
in a Windows OS computer and dissect agent header information in a
packet:</p><ol type="1"><li id="jd0e145" style="">Download the Wireshark plugin from  GitHub: <a href="https://github.com/tungstenfabric/tf-vrouter/tree/master/utils/agent_hdr_plugin">https://github.com/tungstenfabric/tf-vrouter/tree/master/utils/agent_hdr_plugin</a>.</li><li id="jd0e151" style="">If you are using Windows 32-bit OS, copy the plugin in
to the following Wireshark directory on your computer: <code class="filepath">C:\Program Files (x86)\Wireshark\</code>.<p>If you are using Windows 64-bit OS, copy the plugin in to the
following Wireshark directory on your computer: <code class="filepath">C:\Program
Files\Wireshark\plugins\</code>.</p></li><li id="jd0e162" style="">Verify that the <code class="filepath">agent_hdr.lua</code> plugin is loaded successfully in Wireshark. Relaunch Wireshark and
navigate to <strong v-pre="">Help</strong> &gt; <strong v-pre="">About Wireshark</strong> &gt; <strong v-pre="">Plugins</strong> to verify that the plugin is loaded in the <strong v-pre="">Plugins</strong> section.</li><li id="step-four-ms" style="">Open command prompt in <kbd class="user-typing" v-pre="">Run as administrator</kbd> mode and navigate to <code class="filepath">C:\Program Files\Wireshark</code> to use              
         editcap. Pass the pcap file through editcap to add a custom
encapsulation type for a packet:<p><code class="inline" v-pre="">editcap -T user0 &lt;pcap-file-to-be-read&gt; &lt;output.pcap&gt;</code></p></li><li id="jd0e192" style="">In Wireshark, navigate to <strong v-pre="">Edit</strong> &gt; <strong v-pre="">Preferences</strong> &gt; <strong v-pre="">Protocols</strong> &gt; <strong v-pre="">DLT_USER</strong> &gt; <strong v-pre="">Edit Encapsulation
Table</strong>.</li><li id="jd0e210" style="">In the <strong v-pre="">Edit Encapsulation Table</strong>, add the <code class="inline" v-pre="">agent_hdr</code> as a payload protocol for the packet. See
.</li><li id="jd0e219" style="">Using Wireshark, open the modified pcap file you generated
in step <a href="adding-agent-header-using-wireshark-plugin.html#step-four-ms">4</a>. Wireshark
displays the parsed packets.</li></ol><p>The <code class="filepath">agent_header.lua</code> plugin
is also available in contrail-tools container. You must perform the
following steps to use the plugin from the contrail-tools container:</p><ol type="1"><li id="jd0e230" style="">Log in to vRouter as a root user.</li><li id="jd0e233" style="">Use the following command to view the summary of eachpacket
in the pcap file:<p><span class="cli" v-pre="">tshark3_2 -nr &lt;pcap file&gt; -o "uat:user_dlts:\"User 0(DLT=147)\",\"ag_hdr\",\"0\",\"\",\"0\",\"\""
-t ad</span></p></li><li id="jd0e239" style="">Use the following command to view detailed informationof
the packets in the pcap file:<p><span class="cli" v-pre="">  tshark3_2 -nr &lt;pcap file&gt; -o "uat:user_dlts:\"User0
(DLT=147)\",\"ag_hdr\",\"0\",\"\",\"0\",\"\"" -T pdml</span></p></li></ol><div class="table"><div class="caption">Release History Table</div><div class="table-row table-head"><div class="table-cell">Release</div><div class="table-cell">Description</div></div><div class="table-row"><div class="table-cell"><a href="#jd0e24">2011</a></div><div class="table-cell">Starting from release 2011, the Wireshark <code class="filepath">agent_header.lua</code> plugin is supported on Macintosh
OS as well as Windows OS computers.</div></div><div class="table-row"><div class="table-cell"><a href="#jd0e12">2008</a></div><div class="table-cell">Contrail Networking Release
2008 and later supports the Wireshark <code class="filepath">agent_header.lua</code> plugin, which enables you to capture and analyze the packets exchanged
between a vRouter data plane and vRouter agent.</div></div></div><sw-prev-next> </sw-prev-next></p>