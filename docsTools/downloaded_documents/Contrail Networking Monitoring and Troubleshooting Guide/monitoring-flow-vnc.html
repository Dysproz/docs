<p id="topic-content"><h1 id="jd0e3">Query &gt; Flows</h1><sw-topic-details date="2020-09-16"> </sw-topic-details><p>Select <strong v-pre="">Query &gt; Flows</strong> to perform rich and complex
SQL-like queries on flows in the Contrail Controller. You can use
the query results for such things as gaining insight into the operation
of applications in a virtual network, performing historical analysis
of flow issues, and pinpointing problem areas with flows.</p><h2 id="id-query-flows-flow-series">Query &gt; Flows &gt; Flow Series</h2><p>Select <strong v-pre="">Query &gt; Flows &gt; Flow Series</strong> to create queries
of the flow series table. The results are in the form of time series
data for flow series. See <a href="monitoring-flow-vnc.html#flow-query">Figure 1</a>.</p><figure id="flow-query"><figcaption>Figure 1: Query Flow Series Window</figcaption><div class="graphic"><img alt="Query Flow Series Window" src="images/s041598.gif" style=""/></div></figure><p>The query fields available on the screen for the <strong v-pre="">Flow Series</strong> tab are described in <a href="monitoring-flow-vnc.html#flow-table">Table 1</a>. Enter query
data into the fields to create a SQL-like query to display and analyze
flows.</p><sw-table><p class="SubTitle" id="flow-table">Table 1: Query Flow Series Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Range</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select a range of time to display the flow series:</p><ul><li style=""><p>Last 10 Mins</p></li><li style=""><p>Last 30 Mins</p></li><li style=""><p>Last 1 Hr</p></li><li style=""><p>Last 6 Hrs</p></li><li style=""><p>Last 12 Hrs</p></li><li style=""><p>Custom</p></li></ul><p>Click <strong v-pre="">Custom</strong> to enter a specific custom time range
in two fields: <strong v-pre="">From Time</strong> and <strong v-pre="">To Time</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Select</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Select</strong> window (<a href="monitoring-flow-vnc.html#select-flow">Figure 2</a>), where you can click
one or more boxes to select the fields to display from the flow series,
such as <strong v-pre="">Source VN, Dest VN, Bytes, Packets</strong>, and more. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Where</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a query-writing
window, where you can specify query values for variables such as <strong v-pre="">sourcevn, sourceip, destvn, destip, protocol, sport, dport</strong>. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Direction </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the desired flow direction: <strong v-pre="">INGRESS</strong> or <strong v-pre="">EGRESS</strong>.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Filter</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Filter</strong> window (<a href="monitoring-flow-vnc.html#filter-flow">Figure 3</a>), where you can select
filter items to sort by, the sort order, and limits to the number
of results returned.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Run Query</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Run Query</strong> to retrieve the flows that
match the query you created. The flows are listed on the lower portion
of the screen in a box with columns identifying the selected fields
for each flow. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>(graph buttons)</p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>When <strong v-pre="">Time Granularity</strong> is selected, you have
the option to view results in graph or flowchart form. Graph buttons
appear on the screen above the <strong v-pre="">Export</strong> button. Click a graph
button to transform the tabular results into a graphical chart display.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Export</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The Export button is displayed after you click <strong v-pre="">Run
Query</strong>. This allows you to export the list of flows to a text <code class="inline" v-pre="">.csv</code> file.</p></td></tr></tbody></table></sw-table><p>The <strong v-pre="">Select</strong> window allows you to select one or more
attributes of a flow series by clicking the check box for each attribute
desired, see <a href="monitoring-flow-vnc.html#select-flow">Figure 2</a>. The upper section
of the <strong v-pre="">Select</strong> window includes field names, and the lower
portion lets you select units. Select <strong v-pre="">Time Granularity</strong> and
then select <strong v-pre="">SUM(Bytes)</strong> or <strong v-pre="">SUM(Packets)</strong> to aggregate
bytes and packets in intervals. </p><figure id="select-flow"><figcaption>Figure 2: Flow Series Select </figcaption><div class="graphic"><img alt="Flow Series Select " src="images/s041600.gif" style=""/></div></figure><p>Use the <strong v-pre="">Filter</strong> window to refine the display of query
results for flows, by defining an attribute by which to sort the results,
the sort order of the results, and any limit needed to restrict the
number of results. See <a href="monitoring-flow-vnc.html#filter-flow">Figure 3</a>.</p><figure id="filter-flow"><figcaption>Figure 3: Flow Series Filter </figcaption><div class="graphic"><img alt="Flow Series Filter " src="images/s041599.gif" style=""/></div></figure><h2 id="id-example-query-flow-series">Example: Query Flow Series</h2><p>The following is an example flow series query that returns the
time series of the summation traffic in bytes for all combinations
of source VN and destination VN for the last 10 minutes, with the
bytes aggregated in 10 second intervals. See <a href="monitoring-flow-vnc.html#flow-series-example">Figure 4</a>.</p><figure id="flow-series-example"><figcaption>Figure 4: Example: Query Flow Series </figcaption><div class="graphic"><img alt="Example: Query Flow Series " src="images/s041604.gif" style=""/></div></figure><p>The query returns tabular time series data, see <a href="monitoring-flow-vnc.html#series-tabular">Figure 5</a>, for the following combinations of
Source VN and Dest VN: </p><ol><li style=""><p>Flow Class 1: Source VN = default-domain:demo:front-end,
Dest VN=__UNKNOWN__ </p></li><li style=""><p>Flow Class 2: Source VN = default-domain:demo:front-end,
Dest VN=default-domain:demo:back-end</p></li></ol><figure id="series-tabular"><figcaption>Figure 5: Query Flow Series Tabular Results</figcaption><div class="graphic"><img alt="Query Flow Series Tabular Results" src="images/s041605.gif" style=""/></div></figure><p>Because <strong v-pre="">Time Granularity</strong> is selected, the results
can also be displayed as graphical charts. Click the graph button
on the right side of the tabular results. The results are displayed
in a graphical flow chart. See <a href="monitoring-flow-vnc.html#series-graphical">Figure 6</a>. </p><figure id="series-graphical"><figcaption>Figure 6: Query Flow Series Graphical Results</figcaption><div class="graphic"><img alt="Query Flow Series Graphical Results" src="images/s041611.gif" style=""/></div></figure><h2 id="id-query-flow-records">Query &gt; Flow Records</h2><p>Select <strong v-pre="">Query &gt; Flow Records</strong> to create queries of
individual flow records for detailed debugging of connectivity issues
between applications and virtual machines. Queries at this level return
records of the active flows within a given time period.</p><figure id="flow-record-query"><figcaption>Figure 7: Flow Records</figcaption><div class="graphic"><img alt="Flow Records" src="images/s041601.gif" style=""/></div></figure><p>The query fields available on the screen for the <strong v-pre="">Flow Records</strong> tab are described in <a href="monitoring-flow-vnc.html#flow-records-table1">Table 2</a>.
Enter query data into the fields to create an SQL-like query to display
and analyze flows.</p><sw-table><p class="SubTitle" id="flow-records-table1">Table 2: Query Flow Records Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Range</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select a range of time for the flow records:</p><ul><li style=""><p>Last 10 Mins</p></li><li style=""><p>Last 30 Mins</p></li><li style=""><p>Last 1 Hr</p></li><li style=""><p>Last 6 Hrs</p></li><li style=""><p>Last 12 Hrs</p></li><li style=""><p>Custom</p></li></ul><p>Click <strong v-pre="">Custom</strong> to enter a specified custom time range
in two fields: <strong v-pre="">From Time</strong> and <strong v-pre="">To Time</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Select</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Select</strong> window (<a href="monitoring-flow-vnc.html#select-flow-records">Figure 8</a>), where you can
click one or more boxes to select attributes to display for the flow
records, including <strong v-pre="">Setup Time, Teardown Time, Aggregate Bytes, </strong> and <strong v-pre="">Aggregate Packets</strong>. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Where</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a query-writing
window where you can specify query values for <strong v-pre="">sourcevn, sourceip,
destvn, destip, protocol, sport, dport</strong>. .</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Direction</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the desired flow direction: <strong v-pre="">INGRESS</strong> or <strong v-pre="">EGRESS</strong>.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Run Query</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Run Query</strong> to retrieve the flow records
that match the query you created. The records are listed on the lower
portion of the screen in a box with columns identifying the fields
for each flow.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Export</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The <strong v-pre="">Export</strong> button is displayed after you click <strong v-pre="">Run Query</strong>, allowing you to export the list of flows to a text <code class="filepath">.csv</code> file.</p></td></tr></tbody></table></sw-table><p>The <strong v-pre="">Select</strong> window allows you to select one or more
attributes to display for the flow records selected, see <a href="monitoring-flow-vnc.html#select-flow-records">Figure 8</a>.</p><figure id="select-flow-records"><figcaption>Figure 8: Flow Records Select Window</figcaption><div class="graphic"><img alt="Flow Records Select Window" src="images/s041602.gif" style=""/></div></figure><p>You can restrict the query to a particular source VN and destination
VN combination using the <strong v-pre="">Where</strong> section. </p><p>The <strong v-pre="">Where Clause</strong> supports logical AND and logical
OR operations, and is modeled as a logical OR of multiple AND terms.
For example: ( (term1 AND term2 AND term3..) OR (term4 AND term5)
OR…).</p><p>Each term is a single variable expression such as <strong v-pre="">Source
VN = VN1</strong>. </p><figure id="jd0e431"><figcaption>Figure 9: Where Clause Window</figcaption><div class="graphic"><img alt="Where Clause Window" src="images/s041608.gif" style=""/></div></figure><h2 id="id-query-flows-query-queue">Query &gt; Flows &gt; Query Queue</h2><p>Select <strong v-pre="">Query &gt; Flows &gt; Query Queue</strong> to display queries
that are in the queue waiting to be performed on the data. See <a href="monitoring-flow-vnc.html#flows-queue">Figure 10</a>.</p><figure id="flows-queue"><figcaption>Figure 10: Flows Query Queue</figcaption><div class="graphic"><img alt="Flows Query Queue" src="images/s041592.gif" style=""/></div></figure><p>The query fields available on the screen for the <strong v-pre="">Flow Records</strong> tab are described in <a href="monitoring-flow-vnc.html#flow-records-table">Table 3</a>. Enter
query data into the fields to create an SQL-like query to display
and analyze flows.</p><sw-table><p class="SubTitle" id="flow-records-table">Table 3: Query Flow Records Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Date</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The date and time the query was started. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Query</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>A display of the parameters set for the query. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Progress</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The percentage completion of the query to date. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Records </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The number of records matching the query to date.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Status</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The status of the query, such as <strong v-pre="">completed</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Taken</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The amount of time in seconds it has taken the query
to return the matching records.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>(Action icon)</p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the <strong v-pre="">Action</strong> icon and select <strong v-pre="">View
Results</strong> to view a list of the records that match the query,
or click <strong v-pre="">Delete</strong> to remove the query from the queue.</p></td></tr></tbody></table></sw-table><sw-prev-next> </sw-prev-next></p>