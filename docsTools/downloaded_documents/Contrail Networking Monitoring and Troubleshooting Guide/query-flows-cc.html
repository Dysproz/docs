<p id="topic-content"><h1 id="jd0e2">Creating a Query for Flows</h1><sw-topic-details date="2020-09-16"> </sw-topic-details><p>Select <strong v-pre="">Query &gt; Flows</strong> to perform rich and complex
SQL-like queries on flows in the Contrail Controller. You can use
the query results for such things as gaining insight into the operation
of applications in a virtual network, performing historical analysis
of flow issues, and pinpointing problem areas with flows.</p><h2 id="jd0e16">Query Flow Series Table</h2><p>Select <strong v-pre="">Query &gt; Flows &gt; Series</strong> to create queries of
the flow series table. The results are in the form of time series
data for flow series. See <a href="query-flows-cc.html#query-flows-series">Figure 1</a>.</p><figure id="query-flows-series"><figcaption>Figure 1: Query Flow Series Window</figcaption><div class="graphic"><img alt="Query Flow Series Window" src="documentation/images/s008307.PNG" style=""/></div></figure><p>The query fields available on the screen for the <strong v-pre="">Series</strong> tab are described in <a href="query-flows-cc.html#flow-table">Table 1</a>. Enter query
data into the fields to create a SQL-like query to display and analyze
flows.</p><sw-table><p class="SubTitle" id="flow-table">Table 1: Query Flow Series Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Range</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select a range of time to display the flow series:</p><ul><li style=""><p>Last 10 Mins</p></li><li style=""><p>Last 30 Mins</p></li><li style=""><p>Last 1 Hr</p></li><li style=""><p>Last 6 Hrs</p></li><li style=""><p>Last 12 Hrs</p></li><li style=""><p>Custom</p></li></ul><p>Click <strong v-pre="">Custom</strong> to enter a specific custom time range
in two fields: <strong v-pre="">Start Time</strong> and <strong v-pre="">End Time</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Select Terms</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Select Terms</strong> window (<a href="query-flows-cc.html#select-terms">Figure 2</a>), where you can click
one or more fields to display from the flow series, such as <strong v-pre="">Virtual
Router, Source VN, Destination VN, SUM(bytes), SUM(packets)</strong>,
and more. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Direction </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the desired flow direction: <strong v-pre="">Ingress</strong> or <strong v-pre="">Egress</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Where</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the <strong v-pre="">+Add</strong> to open a query-writing window, where
you can specify query values for variables such as <strong v-pre="">destvn, protocol,
sourcevn, and vrouter</strong>.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Filter</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Filters</strong> window (<a href="query-flows-cc.html#query-flows-series">Figure 1</a>), where you can
select filter items to sort by, the sort order, and limits to the
number of results returned.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Granularity</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>When <strong v-pre="">Time Granularity</strong> is selected, you have the option
to view results in graph or flowchart form. Graph buttons appear on
the screen above the <strong v-pre="">Export</strong> button. Click a graph button
to transform the tabular results into a graphical chart display.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Unit</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select minutes or seconds for unit of measurement.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Run</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Run</strong> to retrieve the flows that match the query
you created. The flows are listed on the lower portion of the screen
in a box with columns identifying the selected fields for each flow. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Export</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The Export button is displayed after you click <strong v-pre="">Run</strong>. This allows you to export the list of flows to a text <code class="inline" v-pre="">.csv</code> file.</p></td></tr></tbody></table></sw-table><p>The <strong v-pre="">Select Terms</strong> window allows you to select one
or more attributes of a flow series by clicking each attribute desired.
See <a href="query-flows-cc.html#select-terms">Figure 2</a>. Select <strong v-pre="">SUM(Bytes)</strong> or <strong v-pre="">SUM(Packets)</strong> to aggregate bytes and packets in intervals. </p><figure id="select-terms"><figcaption>Figure 2: Flow Series Select Terms</figcaption><div class="graphic"><img alt="Flow Series Select Terms" src="documentation/images/s008305.PNG" style=""/></div></figure><p>Use the <strong v-pre="">Filters</strong> window to refine the display of query
results for flows, by defining an attribute by which to sort the results,
the sort order of the results, and any limit needed to restrict the
number of results. See <a href="query-flows-cc.html#flow-series-filter">Figure 3</a>.</p><figure id="flow-series-filter"><figcaption>Figure 3: Flows Series Filter </figcaption><div class="graphic"><img alt="Flows Series Filter " src="documentation/images/s008306.PNG" style=""/></div></figure><h2 id="jd0e222">Query Individual Flow Records</h2><p>Select <strong v-pre="">Query &gt; Flow &gt; Records</strong> to create queries of
individual flow records for detailed debugging of connectivity issues
between applications and virtual machines. Queries at this level return
records of the active flows within a given time period.</p><figure id="select-records-2005"><figcaption>Figure 4: Flows Records</figcaption><div class="graphic"><img alt="Flows Records" src="documentation/images/s008308.PNG" style=""/></div></figure><p>The query fields available on the screen for the <strong v-pre="">Records</strong> tab are described in <a href="query-flows-cc.html#flow-records-table1">Table 2</a>.
Enter query data into the fields to create an SQL-like query to display
and analyze flows.</p><sw-table><p class="SubTitle" id="flow-records-table1">Table 2: Query Flow Records Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Range</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select a range of time for the flow records:</p><ul><li style=""><p>Last 10 Mins</p></li><li style=""><p>Last 30 Mins</p></li><li style=""><p>Last 1 Hr</p></li><li style=""><p>Last 6 Hrs</p></li><li style=""><p>Last 12 Hrs</p></li><li style=""><p>Custom</p></li></ul><p>Click <strong v-pre="">Custom</strong> to enter a specified custom time range
in two fields: <strong v-pre="">Start Time</strong> and <strong v-pre="">End Time</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Select Terms</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the edit button (pencil icon) to open a <strong v-pre="">Select Terms</strong> window (<a href="query-flows-cc.html#select-records-2005">Figure 4</a>), where you can
click one or more attributes to display for the flow records, including <strong v-pre="">vrouter, sourcevn, sourceip, destvn, destip, protocol, dport, </strong> and <strong v-pre="">action</strong>. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Direction</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the desired flow direction: <strong v-pre="">Ingress</strong> or <strong v-pre="">Egress</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Where</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">+Add</strong> to open a query window where you can specify
query values for <strong v-pre="">destvn, protocol, sourcevn,</strong> and <strong v-pre="">vrouter</strong>. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Run</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Run</strong> to retrieve the flow records that match
the query you created. The records are listed on the lower portion
of the screen in a box with columns identifying the fields for each
flow.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Export</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The <strong v-pre="">Export</strong> button is displayed after you click <strong v-pre="">Run</strong>, allowing you to export the list of flows to a text <code class="filepath">.csv</code> file.</p></td></tr></tbody></table></sw-table><p>The <strong v-pre="">Select Terms </strong> window allows you to select one
or more attributes to display for the flow records selected. See <a href="query-flows-cc.html#records-select-terms">Figure 5</a>.</p><figure id="records-select-terms"><figcaption>Figure 5: Flows Records Select Terms</figcaption><div class="graphic"><img alt="Flows Records Select Terms" src="documentation/images/s008337.png" style=""/></div></figure><h2 id="jd0e383">Using the Query Window</h2><p>The query window is available by clicking the <strong v-pre="">+Add</strong> in the <strong v-pre="">Where</strong> field. Use the query window to enter query
statements. See <a href="query-flows-cc.html#records-select-terms">Figure 5</a>. </p><p>You can restrict the query to a particular source VN and destination
VN combination using the <strong v-pre="">Select</strong> section. </p><p>The <strong v-pre="">Where</strong> supports logical AND and logical OR operations,
and is modeled as a logical OR of multiple AND terms. For example:
( (term1 AND term2 AND term3..) OR (term4 AND term5) OR…).</p><p>Each term is a single variable expression such as <strong v-pre="">sourcevn
= vn1</strong>. </p><p>See <a href="query-flows-cc.html#query-window-fields">Table 3</a> for descriptions
of the fields in the query window.</p><sw-table><p class="SubTitle" id="query-window-fields">Table 3: Query Window Fields and Descriptions</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Item</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>—</p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from a list of available item types the type from which
to query. </p><ul><li style=""><p>destvn</p></li><li style=""><p>protocol</p></li><li style=""><p>sourcevn</p></li><li style=""><p>vrouter</p></li></ul></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>(operator)</p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">=</strong>(equal to) and <strong v-pre="">Starts with</strong> are available.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">AND +</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the <strong v-pre="">+Add</strong> to add more elements to your query.
Repeat to include additional query elements to your query statement.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Apply</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click to enter the query into the fields on the main screen. </p></td></tr></tbody></table></sw-table><p>The <strong v-pre="">Where</strong> clause supports logical AND and logical
OR operations. </p><p>The <strong v-pre="">Where</strong> can be modeled as logical OR of multiple
AND terms. ( (term1 AND term2 AND term3..) OR (term4 AND term5) OR…). </p><p>Each term is a single variable expression such as <strong v-pre="">Source
VN = VN1.</strong></p><h2 id="jd0e495">Display Flows Query Queue</h2><p>Select <strong v-pre="">Query &gt; Flows &gt; Query Queue</strong> to display queries
that are in the queue waiting to be performed on the data. </p><p>The query fields available on the screen for the <strong v-pre="">Records</strong> tab are described in <a href="query-flows-cc.html#flow-records-table">Table 4</a>. Enter
query data into the fields to create an SQL-like query to display
and analyze flows.</p><sw-table><p class="SubTitle" id="flow-records-table">Table 4: Query Flow Records Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Date</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The date and time the query was started. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Query</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>A display of the parameters set for the query. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Progress</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The percentage completion of the query to date. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Records </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The number of records matching the query to date.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Status</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The status of the query, such as <strong v-pre="">completed</strong>.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Time Taken</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The amount of time in seconds it has taken the query to return
the matching records.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>(Action icon)</p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click the <strong v-pre="">Action</strong> icon and select <strong v-pre="">View Results</strong> to view a list of the records that match the query, or click <strong v-pre="">Delete</strong> to remove the query from the queue.</p></td></tr></tbody></table></sw-table><sw-prev-next> </sw-prev-next></p>