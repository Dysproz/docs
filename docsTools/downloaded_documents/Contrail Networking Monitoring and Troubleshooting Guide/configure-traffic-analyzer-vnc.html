<p id="topic-content"><h1 id="jd0e3">Configuring Traffic Analyzers and Packet Capture for Mirroring</h1><sw-topic-details date="2019-07-11"> </sw-topic-details><p>Contrail provides traffic mirroring so you can mirror
specified traffic to a traffic analyzer where you can perform deep
traffic inspection. Traffic mirroring enables you to designate certain
traffic flows to be mirrored to a traffic analyzer, where you can
view traffic flows in great detail.</p><div id="intro"><div class="mini-toc-intro"><p>This section describes how to set up packet
capture to mirror traffic packets to an analyzer. </p></div></div><h2 id="jd0e17">Traffic Analyzer Images</h2><p>Before using the Contrail interface to configure traffic analyzers
and packet capture for mirroring, make sure that the following analyzer
images are available in the VM image list for your system. The traffic
analyzer images are enhanced for viewing details of captured packets
in Wireshark. When creating a policy for the traffic analyzer, the
traffic analyzer instance should always have the <strong v-pre="">Mirror to</strong> field selected in the policy, do not select the <strong v-pre="">Apply Service</strong> field for a traffic analyzer.</p><ul><li style=""><p><strong v-pre="">analyzer-vm-console-qcow2</strong>—Standard traffic
analyzer; should be named <strong v-pre="">analyzer</strong> in the image list. This
type of traffic analyzer is always configured with a single interface,
and the interface should be a <strong v-pre="">Left</strong> interface.</p></li><li style=""><p><strong v-pre="">analyzer-vm-console-two-if qcow2</strong>—This
type of traffic analyzer has two interfaces, <strong v-pre="">Left</strong> and <strong v-pre="">Management</strong>. This traffic analyzer can have any name except
the name <strong v-pre="">analyzer</strong>, which is reserved for the single interface
analyzer. </p></li></ul><sw-admonition name="note" style=""><strong class="title">Note</strong><p>The <code class="inline" v-pre="">analyzer-vm</code> images are
valid for all versions of Contrail. Download the images from the Contrail
1.0 software download page: <a href="https://www.juniper.net/support/downloads/?p=contrail#sw">https://www.juniper.net/support/downloads/?p=contrail#sw</a> .</p></sw-admonition><h2 id="jd0e66">Configuring Traffic Analyzers </h2><p>Contrail Controller enables you to mirror captured packet
traffic to a traffic analyzer. Follow these steps to mirror captured
packet traffic:</p><ol><li style=""><p>Configure analyzer(s) on the host.</p></li><li style=""><p>Set up rules for packet capture.</p></li></ol><p>You can set up traffic mirroring using <strong v-pre="">Configure &gt; Networking
&gt; Services</strong>. For more information, see <a href="configure-traffic-analyzer-vnc.html#set-up-traffic-mirrioring">Setting Up Traffic Mirroring Using Configure &gt; Networking &gt;
Services</a>.</p><h2 id="set-up-traffic-mirrioring">Setting Up Traffic Mirroring Using Configure &gt; Networking &gt;
Services</h2><p>Follow these steps to set up traffic mirroring using <strong v-pre="">Configure
&gt; Networking &gt; Services</strong>.</p><ol type="1"><li id="jd0e99" style="">Access <strong v-pre="">Configure &gt; Services &gt; Service Templates</strong>.<p>The <strong v-pre="">Service Templates</strong> screen appears; see <a href="configure-traffic-analyzer-vnc.html#config-svc-templ">Figure 1</a>.</p><figure id="config-svc-templ"><figcaption>Figure 1: Service Templates</figcaption><div class="graphic"><img alt="Service Templates" src="images/s041612.gif" style=""/></div></figure></li><li id="jd0e116" style="">To create a new service template, click the <strong v-pre="">+</strong> icon. <p>The <strong v-pre="">Create</strong> window appears. Select the Service Template
tab; see <a href="configure-traffic-analyzer-vnc.html#add-svc-templ">Figure 2</a>. </p><figure id="add-svc-templ"><figcaption>Figure 2: Create Service Template</figcaption><div class="graphic"><img alt="Create Service Template" src="images/s041613.gif" style=""/></div></figure></li><li id="jd0e133" style="">Complete the fields by using the guidelines in <a href="configure-traffic-analyzer-vnc.html#svc-templ-fields-analyzer">Table 1</a>.<sw-table><p class="SubTitle" id="svc-templ-fields-analyzer">Table 1: Create Service Template
Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Name</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a descriptive text name for this service template.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Version</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select <strong v-pre="">v2</strong> from the drop-down list to indicate
that this service template is based on templates version 2, valid
for Contrail 3.0 and later.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Virtualization Type</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select <strong v-pre="">Virtual Machine</strong> from the drop-down
list to indicate the virtualization type for mirroring for this template.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Service Mode</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select <strong v-pre="">Transparent</strong> from the drop-down list
to indicate that this service template is for transparent mirroring.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Service Type</strong> </p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select <strong v-pre="">Analyzer</strong> from the drop-down list to
indicate that this service template is for a traffic analyzer.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Interface(s)</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>From the drop-down list, click the check boxes to indicate
which interface types are used for this analyzer service template:</p><ul><li style=""><p>Left</p></li><li style=""><p>Right</p></li><li style=""><p>Management</p></li></ul></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Save</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>When finished, click <strong v-pre="">OK</strong> to commit the changes</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Cancel</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Cancel</strong> to clear the fields and start
over.</p></td></tr></tbody></table></sw-table></li><li id="jd0e246" style="">Create a service instance by clicking the <strong v-pre="">Service
Instances</strong> link and clicking the <strong v-pre="">+</strong> icon. <p>The <strong v-pre="">Create</strong> window appears; make sure the Service
Instance tab is selected. See <a href="configure-traffic-analyzer-vnc.html#add-serv-inst">Figure 3</a>. </p><figure id="add-serv-inst"><figcaption>Figure 3: Create Service Instances</figcaption><div class="graphic"><img alt="Create Service Instances" src="images/s041858.gif" style=""/></div></figure></li><li id="jd0e266" style="">Complete the fields by using the guidelines in <a href="configure-traffic-analyzer-vnc.html#add-svc-inst-fields">Table 2</a>.<sw-table><p class="SubTitle" id="add-svc-inst-fields">Table 2: Create Service Instances Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Name</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a text name for this service instance.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Service Template</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from a drop-down list of available service templates
the template to use for this service instance, analyzer-service-template
in this example.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Interface Type</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Each interface configured in the service template for
this instance appears in a list.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Virtual Network</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from a drop-down list of available virtual networks
the network for each interface that is configured for the instance. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Save</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Save</strong> to commit your changes.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Cancel</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Cancel</strong> to clear your changes and start
over.</p></td></tr></tbody></table></sw-table></li><li id="jd0e341" style="">To create a network policy rule for this service instance,
click <strong v-pre="">Configure &gt; Networking &gt; Policies</strong>. The <strong v-pre="">Policies</strong> window appears. Click the <strong v-pre="">+</strong> icon to get to the <strong v-pre="">Create </strong> window; see <a href="configure-traffic-analyzer-vnc.html#config-netw-pol">Figure 4</a>.<figure id="config-netw-pol"><figcaption>Figure 4: Create Policy</figcaption><div class="graphic"><img alt="Create Policy" src="images/s041859.gif" style=""/></div></figure></li><li id="jd0e364" style="">Enter a name for the policy, then click the + icon in
the lower portion of the screen to configure rules for the policy,
see <a href="configure-traffic-analyzer-vnc.html#add-rule-svc-inst">Figure 5</a>.<figure id="add-rule-svc-inst"><figcaption>Figure 5: Create Policy Rules</figcaption><div class="graphic"><img alt="Create Policy Rules" src="images/s041833.gif" style=""/></div></figure></li><li id="jd0e373" style=""> To add policy rules, complete the fields, using the guidelines
in <a href="configure-traffic-analyzer-vnc.html#add-rule-svc-inst-fields">Table 3</a>. <sw-admonition name="note" style=""><strong class="title">Note</strong><p>When there is a network policy attached to the virtual
network, any conflicting rules configured for the analyzer will not
take effect.</p></sw-admonition><sw-table><p class="SubTitle" id="add-rule-svc-inst-fields">Table 3: Add Rule Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Action</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select PASS or DENY as the rule action.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Protocol</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the protocol for the policy rule, or select ANY. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Source</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from multiple drop-down lists the source for this
rule, including options under CIDR, Network, Policy, or Security Group. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre=""> Ports</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from a drop-down list the source ports for the
rule.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Direction</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the direction of flow for the packets to be captured:</p><ul><li style=""><p>&lt;&gt; (bidirectional)</p></li><li style=""><p>&gt; (unidirectional)</p></li></ul></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Destination </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from multiple drop-down lists the destination
for this rule, including options under CIDR, Network, Policy, or Security
Group. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Ports</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select from a list the destination ports for the packets
to be captured.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">check boxes</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Check any box that applies to this rule: Log, Services,
Mirror, QoS.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Save</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Save</strong> to commit your changes.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Cancel</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Click <strong v-pre="">Cancel</strong> to clear your changes and start
over.</p></td></tr></tbody></table></sw-table></li><li id="jd0e490" style="">When finished, click <strong v-pre="">Save</strong>.</li><li id="jd0e496" style="">To verify packet capture, at <strong v-pre="">Configure &gt; Services
&gt; Service Instances</strong>, select the analyzer service instance and
click <strong v-pre="">View Console</strong>. <p>The packet capture displays; see <a href="configure-traffic-analyzer-vnc.html#view-console-analyzer">Figure 6</a>. The analyzer service VM launches
the Contrail-enhanced Wireshark as it starts and captures the mirrored
packets destined to this service. </p><figure id="view-console-analyzer"><figcaption>Figure 6: Service Instances View Console</figcaption><div class="graphic"><img alt="Service Instances View Console" src="images/s041869.gif" style=""/></div></figure></li></ol><sw-prev-next> </sw-prev-next></p>