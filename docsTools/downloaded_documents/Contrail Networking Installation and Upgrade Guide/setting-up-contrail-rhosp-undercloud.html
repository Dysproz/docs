<p id="topic-content"><h1 id="jd0e3">Setting Up the Undercloud</h1><sw-topic-details date="2020-07-07"> </sw-topic-details><h2 id="id-install-the-undercloud">Install the Undercloud</h2><p>Use this example procedure to install the undercloud.</p><ol type="1"><li id="jd0e20" style="">Log in to the undercloud VM from the undercloud KVM host.<div class="example" dir="ltr" id="jd0e23"><sw-code><template v-pre=""><pre>ssh ${undercloud_ip}</pre></template></sw-code></div></li><li id="jd0e26" style="">Configure the hostname.<div class="example" dir="ltr" id="jd0e29"><sw-code><template v-pre=""><pre>undercloud_name=`hostname -s` <br/>undercloud_suffix=`hostname -d` <br/>hostnamectl set-hostname ${undercloud_name}.${undercloud_suffix} <br/>hostnamectl set-hostname --transient ${undercloud_name}.${undercloud_suffix}</pre></template></sw-code></div></li><li id="jd0e38" style="">Add the hostname to the <code class="filepath">/etc/hosts</code> file. The following example assumes the management interface is
eth0.<div class="example" dir="ltr" id="jd0e44"><sw-code><template v-pre=""><pre>undercloud_ip=`ip addr sh dev eth0 | grep "inet " | awk '{print $2}' | awk -F"/" '{print $1}'`
echo ${undercloud_ip} ${undercloud_name}.${undercloud_suffix} ${undercloud_name} &gt;&gt; /etc/hosts</pre></template></sw-code></div></li><li id="jd0e47" style="">Set up the repositories.<ul><li style=""><p>CentOS</p><div class="example" dir="ltr" id="jd0e54"><sw-code><template v-pre=""><pre>tripleo_repos=`python -c 'import requests;r = requests.get("https://trunk.rdoproject.org/centos7-queens/current"); print r.text ' | grep python2-tripleo-repos|awk -F"href=\"" '{print $2}' | awk -F"\"" '{print $1}'` 
yum install -y https://trunk.rdoproject.org/centos7-queens/current/${tripleo_repos} 
tripleo-repos -b queens current</pre></template></sw-code></div></li><li style=""><p>RHEL</p><div class="example" dir="ltr" id="jd0e60"><sw-code><template v-pre=""><pre>#Register with Satellite (can be done with CDN as well) <br/>satellite_fqdn=device.example.net <br/>act_key=xxx <br/>org=example <br/>yum localinstall -y http://${satellite_fqdn}/pub/katello-ca-consumer-latest.noarch.rpm <br/>subscription-manager register --activationkey=${act_key} --org=${org}</pre></template></sw-code></div></li></ul></li><li id="jd0e73" style="">Install the Tripleo client.<div class="example" dir="ltr" id="jd0e76"><sw-code><template v-pre=""><pre>yum install -y python-tripleoclient tmux</pre></template></sw-code></div></li><li id="jd0e79" style="">Copy the undercloud configuration file sample and modify
the configuration as required. See <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/13/html-single/director_installation_and_usage/">Red Hat documentation</a> for information on how to modify that
file.<div class="example" dir="ltr" id="jd0e85"><sw-code><template v-pre=""><pre>su - stack <br/>cp /usr/share/instack-undercloud/undercloud.conf.sample ~/undercloud.conf
vi ~/undercloud.conf</pre></template></sw-code></div></li><li id="jd0e90" style="">Install the undercloud.<div class="example" dir="ltr" id="jd0e93"><sw-code><template v-pre=""><pre>openstack undercloud install <br/>source stackrc</pre></template></sw-code></div></li></ol><h2 id="id-perform-postinstallation-tasks">Perform Post-Install Configuration</h2><ol type="1"><li id="jd0e106" style="">Configure a forwarding path between the provisioning network
and the external network:<div class="example" dir="ltr" id="jd0e109"><sw-code><template v-pre=""><pre>sudo iptables -A FORWARD -i br-ctlplane -o eth0 -j ACCEPT <br/>sudo iptables -A FORWARD -i eth0 -o br-ctlplane -m state --state RELATED,ESTABLISHED -j ACCEPT <br/>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</pre></template></sw-code></div></li><li id="jd0e116" style="">Add the external API interface:<div class="example" dir="ltr" id="jd0e119"><sw-code><template v-pre=""><pre>sudo ip link add name vlan720 link br-ctlplane type vlan id 720 <br/>sudo ip addr add 10.2.0.254/24 dev vlan720 <br/>sudo ip link set dev vlan720 up</pre></template></sw-code></div></li><li id="jd0e126" style="">Add the <code class="inline" v-pre="">stack</code> user to the docker
group:<div class="example" dir="ltr" id="jd0e132"><sw-code><template v-pre=""><pre>newgrp docker <br/>exit <br/>su - stack <br/>source stackrc</pre></template></sw-code></div></li></ol><sw-prev-next> </sw-prev-next></p>