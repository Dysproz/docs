<p id="topic-content"><h1 id="jd0e2">Configuring the Control Node with BGP</h1><sw-topic-details date="2020-03-18"> </sw-topic-details><div id="intro"><div class="mini-toc-intro"><p>An important task after a successful installation
is to configure the control node with BGP. This procedure shows how
to configure basic BGP peering between one or more virtual network
controller control nodes and any external BGP speakers. External BGP
speakers, such as Juniper Networks MX80 routers, are needed for connectivity
to instances on the virtual network from an external infrastructure
or a public network.</p><p>Before you begin, ensure that the following tasks are completed:</p><ul><li style=""><p>The Contrail Controller base system image has been installed
on all servers.</p></li><li style=""><p>The role-based services have been assigned and provisioned.</p></li><li style=""><p>IP connectivity has been verified between all nodes of
the Contrail Controller.</p></li><li style=""><p>You have access to Contrail Web User Interface (UI) or
Contrail Command User Interface (UI). You can access the user interface
at <strong v-pre="">http://<var v-pre="">nn.nn.nn.nn</var>:8143</strong>, where <strong v-pre=""><var v-pre="">nn.nn.nn.nn</var></strong> is the IP address of the configuration
node server that is running the contrail service.</p></li></ul><p>These topics provide instructions to configure the Control Node
with BGP.</p></div></div><h2 id="id-configuring-the-control-node-from-contrail-web-ui">Configuring the Control Node from Contrail Web UI</h2><p>To configure BGP peering in the control node:</p><ol type="1"><li id="jd0e52" style="">From the Contrail Controller module control node (<strong v-pre="">http://<var v-pre="">nn.nn.nn.nn</var>:8143</strong>), select <strong v-pre="">Configure &gt; Infrastructure &gt; BGP Routers</strong>; see <a href="config-control-node-with-bgp.html#config-bgp-peers">Figure 1</a>.<figure id="config-bgp-peers"><figcaption>Figure 1: Configure&gt; Infrastructure &gt; BGP
Routers</figcaption><div class="graphic"><img alt="Configure&gt; Infrastructure &gt; BGP
Routers" src="images/s042497.png" style=""/></div></figure><p>A summary screen of the control nodes and BGP routers is displayed;
see <a href="config-control-node-with-bgp.html#control-nodes-summary">Figure 2</a>.</p><figure id="control-nodes-summary"><figcaption>Figure 2: BGP Routers Summary </figcaption><div class="graphic"><img alt="BGP Routers Summary " src="images/s042498.png" style=""/></div></figure></li><li id="jd0e79" style="">(Optional) The global AS number is 64512 by default. To
change the AS number, on the <strong v-pre="">BGP Router</strong> summary screen
click the gear wheel and select <strong v-pre="">Edit</strong>. In the Edit BGP Router
window enter the new number.</li><li id="jd0e88" style="">To create control nodes and BGP routers, on the <strong v-pre="">BGP
Routers</strong> summary screen, click the <span class="graphic"><img alt="" src="images/s042494.png" style=""/></span> icon. The <strong v-pre="">Create BGP Router</strong> window is displayed; see <a href="config-control-node-with-bgp.html#add-bgp-peer">Figure 3</a>.<figure id="add-bgp-peer"><figcaption>Figure 3: Create BGP Router</figcaption><div class="graphic"><img alt="Create BGP Router" src="images/s042496.png" style=""/></div></figure></li><li id="jd0e105" style="">In the <strong v-pre="">Create BGP Router</strong> window, click <strong v-pre="">BGP Router</strong> to add a new BGP router or click <strong v-pre="">Control Node</strong> to add control nodes.<p>For each node you want to add, populate the fields with values
for your system. See <a href="config-control-node-with-bgp.html#bgp-peers">Table 1</a>. </p><sw-table><p class="SubTitle" id="bgp-peers">Table 1: Create BGP Router Fields</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Field</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hostname</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a name for the node being added.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Vendor ID </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Required for external peers. Populate with a text identifier,
for example, “MX-0”. (BGP peer only)</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">IP Address</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The IP address of the node.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Router ID</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the router ID.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Autonomous System</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the AS number in the range 1-65535 for the node.
(BGP peer only)</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Address Families</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the address family, for example, <strong v-pre="">inet-vpn</strong></p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hold Time</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>BGP session hold time. The default is 90 seconds; change
if needed.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">BGP Port</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The default is 179; change if needed.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Authentication Mode</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enable MD5 authentication if desired.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Authentication key</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the Authentication Key value.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Physical Router</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The type of the physical router.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Available Peers</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Displays peers currently available.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Configured Peers</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Displays peers currently configured.</p></td></tr></tbody></table></sw-table></li><li id="jd0e243" style="">Click <strong v-pre="">Save</strong> to add each node that you create.</li><li id="jd0e249" style="">To configure an existing node as a peer, select it from
the list in the <strong v-pre="">Available Peers</strong> box, then click <strong v-pre="">&gt;&gt;</strong> to move it into the <strong v-pre="">Configured Peers</strong> box. <p>Click <strong v-pre="">&lt;&lt;</strong> to remove a node from the <strong v-pre="">Configured
Peers</strong> box.</p></li><li id="jd0e269" style="">You can check for peers by selecting <strong v-pre="">Monitor &gt; Infrastructure
&gt; Control Nodes</strong>; see <a href="config-control-node-with-bgp.html#control-node-summ">Figure 4</a>.<figure id="control-node-summ"><figcaption>Figure 4: Control Nodes</figcaption><div class="graphic"><img alt="Control Nodes" src="images/s042499.png" style=""/></div></figure><p>In the <strong v-pre="">Control Nodes</strong> window, click any hostname in
the memory map to view its details; see <a href="config-control-node-with-bgp.html#control-node-details">Figure 5</a>. </p><figure id="control-node-details"><figcaption>Figure 5: Control Node Details</figcaption><div class="graphic"><img alt="Control Node Details" src="images/s042500.png" style=""/></div></figure></li><li id="jd0e292" style="">Click the <strong v-pre="">Peers</strong> tab to view the peers of a
control node; see <a href="config-control-node-with-bgp.html#peer-details">Figure 6</a>.<figure id="peer-details"><figcaption>Figure 6: Control Node Peers Tab</figcaption><div class="graphic"><img alt="Control Node Peers Tab" src="images/s042501.png" style=""/></div></figure></li></ol><h2 id="id-configuring-the-control-node-with-bgp-from-contrail-command">Configuring the Control Node with BGP from Contrail Command</h2><p>To configure BGP peering in the control node:</p><ol type="1"><li id="jd0e316" style="">From Contrail Command UI select <strong v-pre="">Infrastructure &gt;
Cluster &gt; Advanced </strong> page.<p>Click  the <strong v-pre="">BGP Routers</strong> tab. A list of control nodes
and BGP routers is displayed. See <a href="config-control-node-with-bgp.html#config-bgp">Figure 7</a>. </p><figure id="config-bgp"><figcaption>Figure 7: Infrastructure &gt; Cluster &gt; Advanced
&gt; BGP Routers</figcaption><div class="graphic"><img alt="Infrastructure &gt; Cluster &gt; Advanced
&gt; BGP Routers" src="images/s009220.png" style=""/></div></figure></li><li id="jd0e334" style="">(Optional) The global AS number is 64512 by default. You
can change the AS number according to your requirement on the <strong v-pre="">BGP Router</strong> tab, by clicking the <strong v-pre="">Edit</strong> icon. In the <strong v-pre="">Edit BGP Router</strong> tab enter AS number in the range of 1-65,535.  You can also enter the AS number in the range of 1-4,294,967,295, when <strong v-pre="">4 Byte
ASN</strong> is enabled in <strong v-pre="">Global Config</strong>.</li><li id="jd0e352" style="">Click the <strong v-pre="">Create</strong> button on the <strong v-pre="">BGP Routers</strong> tab. The <strong v-pre="">Create BGP Router</strong> window is displayed. See <a href="config-control-node-with-bgp.html#bgp-create">Figure 8</a>.<figure id="bgp-create"><figcaption>Figure 8: Create BGP Router</figcaption><div class="graphic"><img alt="Create BGP Router" src="images/s009221.png" style=""/></div></figure></li><li id="jd0e371" style="">In the <strong v-pre="">Create BGP Router</strong> page, populate the
fields with values to create your system. See <a href="config-control-node-with-bgp.html#controlnodebgp">Table 2</a>.<sw-table><p class="SubTitle" id="controlnodebgp">Table 2: Create BGP Router</p><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Fields</p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Router Type</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the type of router you want create</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hostname</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a name for the node being added.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Vendor ID </strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Required for external peers. Populate with a text identifier,
for example, “MX-0”. (BGP peer only)</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">IP Address</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>The IP address of the node.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Router ID</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the router ID.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Autonomous System (AS)</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter autonomous system (AS) number in the range of 1-65,535.</p><p>If you enable <strong v-pre="">4 Byte ASN</strong> in <strong v-pre="">Global Config</strong>, you can enter 4-byte AS number in the range of 1-4,294,967,295.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">BGP Router ASN</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the Local-AS number, specific to the associated
peers. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Address Families</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the Internet Address Family from the list, for
example, <strong v-pre="">inet-vpn</strong>, <strong v-pre="">inet6-vpn</strong>, and so on.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Cluster ID</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the cluster ID, for example, 0.0.0.100.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><kbd class="user-typing" v-pre="">Associate Peers</kbd></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"> </td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Peer</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the configured peers from the list.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hold Time</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the maximum time a BGP session remains active if
no Keepalives are received.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Loop Count</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the number of times the same ASN can be seen in
a route-update. The route is discarded when the loop count is exceeded. </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">MD5 Auth Key</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the MD5 authentication key value.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">State</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the <strong v-pre="">state</strong> box when you are associating
BGP peers.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Passive</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the <strong v-pre="">passive</strong> box to disable the BGP
router from advertising any routes. The BGP router can only receive
updates from other peers in this state. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><kbd class="user-typing" v-pre="">Advanced Options</kbd></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"> </td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">BGP Port</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter BGP Port number. The default is 179; change if
needed.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Source Port</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter source port number for client side connection.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hold Time (seconds)</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>BGP session hold time. The default is 90 seconds; change
if needed.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Admin State</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the <strong v-pre="">Admin state</strong> box to enable the state
as UP and deselect the box to disable the state to DOWN.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Authentication Mode</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select MD5 from list if required.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Authentication key</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the Authentication Key value.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Control Node Zone</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the required  control node zone from the list.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Physical Router</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the  the physical router from the list.</p></td></tr></tbody></table></sw-table></li><li id="jd0e613" style="">Click <strong v-pre="">Create</strong> to complete add each node.</li><li id="jd0e619" style="">You can check for peers and details about the control
nodes by selecting <strong v-pre="">Infrastructure &gt; Cluster &gt; Control Nodes</strong>. Click the desired node to check the details on <strong v-pre="">Summary</strong> and <strong v-pre="">Detailed Stats</strong> page.</li></ol><sw-prev-next> </sw-prev-next></p>