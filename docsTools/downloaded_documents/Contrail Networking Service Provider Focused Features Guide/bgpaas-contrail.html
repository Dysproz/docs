<p id="topic-content"><h1 id="jd0e3">BGP as a Service</h1><sw-topic-details date="2020-11-11"> </sw-topic-details><h2 id="id-understanding-bgp-as-a-service">Understanding BGP as a Service </h2><div class="mini-toc-intro"><p>The BGP as a Service (BGPaaS) feature allows
a guest virtual machine (VM) to place routes in its own virtual routing
and forwarding (VRF) instance using BGP.</p></div><ul><li style=""><p><a href="bgpaas-contrail.html#jd0e24">Contrail BGPaaS Features</a></p></li><li style=""><p><a href="bgpaas-contrail.html#jd0e109">BGPaaS Use Cases</a></p></li></ul><h3 id="jd0e24">Contrail BGPaaS Features</h3><p>Using BGPaaS with Contrail Networking requires the guest VM
to have connectivity to the control node and to be able to advertise
routes into the VRF instance.</p><p>With the BGPaaS feature:</p><ul><li style=""><p>The vRouter agent is able to accept BGP connections from
the VMs and proxy them to the control node.</p></li><li style=""><p>The vRouter agent always selects one of the control nodes
that it is using as an XMPP server.</p></li></ul><p>Contrail Networking provides route export functionality for
BGPaaS sessions. The next hop for all routes advertised to the tenant
VM is set to the default gateway address of the subnet of the tenant
VM. This allows the tenant BGP implementation to be relatively simple,
by not requiring support for recursive resolution of BGP next hops. </p><p>The BGPaaS object is associated with a virtual machine interface,
not just a virtual machine (VM), which enables a tenant VM to have
BGP sessions in multiple virtual networks, if required.</p><p>BGPaaS in Contrail Networking has the following features:</p><ul><li style=""><p>By default, all BGPaaS sessions are configured to have
bidirectional exchange of routes. The Boolean property <span class="cli" v-pre="">bgpaas-suppress-route-advertisement</span> ensures no advertisement of routes to the tenant VM.</p></li><li style=""><p>If inet6 routes are being advertised to the tenant VM,
they are advertised with the IPv6 subnet's default gateway address
as the BGP next hop. A Boolean property, <span class="cli" v-pre="">bgpaas-ipv4-mapped-ipv6-nexthop</span>, causes the IPv4 subnet's default gateway, in IPv4-mapped IPv6 format,
to be used instead as the next hop.</p></li><li style=""><p>If multiple tenant VMs in the same virtual network have
BGPaaS sessions and they use eBGP, the standard BGP AS path loop prevention
rules prevent routes advertised by one tenant VM from being advertised
to the other tenant VMs. The <span class="cli" v-pre="">as-override</span> field, added to
the existing <code class="inline" v-pre="">BgpSessionAttributes</code> in the
BGPaaS object, causes the control node to replace the AS number of
the tenant VM with it's own AS number, when advertising routes learned
from a tenant VM to another tenant VM in the same virtual network.
The tenant VM does not need to implement any new functionality.</p></li></ul><p>Contrail Networking provides support for high availability (HA)
architectures, BGPaaS supports control node zone selection, with options
available to configure BGPaaS control node zone peers.</p><p>This capability enables you to set up primary and secondary
control node zones, which can have one or more control nodes. The
reason for this is because BGPaaS is often being relied upon to provide
routing to and from VNFs, which are comprised of several nodes across
different computes, and the VNFs usually rely upon two BGP peers for
HA. These control node zone features increase the robustness and failover
capabilities for BGPaaS in Contrail.</p><p>The following are caveats:</p><ul><li style=""><p>BGP sessions must use IPv4 transport.</p></li><li style=""><p>The VNF must support RFC 2545, <cite>Use of BGP-4
Multiprotocol Extensions for IPv6 Inter-Domain Routing</cite>,
to carry IPv6 routes over the IPv4 peer.</p></li><li style=""><p>Only IPv4 (inet) and IPv6 (inet6) address families are
supported.</p></li></ul><p>The following features are supported in Contrail Networking
for BGPaaS configuration:</p><ul><li style=""><p>Global-System-Config has an option to add, modify, or
delete control node zones</p></li><li style=""><p>Control-Node-Zone has an option to add, modify, or delete
control nodes</p></li><li style=""><p>Control node has an option to add, modify or delete a
control node zone and it can have only one control node zone</p></li><li style=""><p>BGPaaS has an option to add, modify, or delete a primary
or secondary control node zone</p></li><li style=""><p>If control node zone has more than one control-node, selection
of control-node for BGP Peering is random in a control node zone</p></li><li style=""><p>Using just one control node in each zone, VNF can predictably
establish bgp-peering to that particular control node.</p></li></ul><h3 id="jd0e109">BGPaaS Use Cases</h3><div class="mini-toc-intro"><p>This section provides example scenarios for implementing BGPaaS
with Contrail.</p></div><ul><li style=""><p><a href="bgpaas-contrail.html#jd0e117">Dynamic Tunnel Insertion Within a Tenant Overlay</a></p></li><li style=""><p><a href="bgpaas-contrail.html#jd0e131">Dynamic Network Reachability of Applications</a></p></li><li style=""><p><a href="bgpaas-contrail.html#jd0e138">Liveness Detection for High Availability</a></p></li></ul><h4 id="jd0e117">Dynamic Tunnel Insertion Within a Tenant Overlay</h4><p>Various applications need to insert dynamic tunnels into virtual
networks. Virtual network functions (VNFs) provide the function of
tunnel termination. Tunnel termination types vary across application
types, such as business VPN, mobility small site backhaul, VPC, and
the like. The key requirement is that tunnels need to insert dynamically
new network reachability information into the virtual network. The
predominant methods of tunnel network reachability insertion use BGP.</p><p>BGPaaS allows the migration of brownfield VNFs into Contrail,
preserving the application behavior and requirement for BGP, without
rewriting the application. </p><p><a href="bgpaas-contrail.html#dyntunnel1">Figure 1</a> shows the need to insert a
dynamic tunnel into a virtual network. </p><figure id="dyntunnel1"><figcaption>Figure 1: Dynamic Tunnel Insertion</figcaption><div class="graphic"><img alt="Dynamic Tunnel Insertion" src="documentation/images/g300441.png" style=""/></div></figure><h4 id="jd0e131">Dynamic Network Reachability of Applications</h4><p>The Domain Name System (DNS) is a widespread application that
uses BGP as a mechanism to tune reachability of its services, based
on metrics such as load, maintenance, availability, and the like.
As DNS services are migrated to environments using overlays, a mechanism
to preserve the existing application behavior and requirements is
needed, including the ability to announce and withdraw reachability
to the available application. </p><p>This requirement is not limited to DNS. Other applications,
such as virtualized evolved packet core (vEPC) and others, use BGP
as a mechanism for network reachability based on availability and
load. </p><h4 id="jd0e138">Liveness Detection for High Availability</h4><p>Various keepalive mechanisms for tenant reachability have been
provided by network components such as BGP, OSPF, PING, VRRP, BFD,
or application-specific mechanisms. With BGP on the vRouter agent,
BGP can be used to provide a liveness detection mechanism between
the tenant on the local compute node and the services that the specific
tenant VM is providing.</p><h2 id="id-configuring-bgpaas-using-vnc-api">Configuring BGPaaS using VNC API</h2><p>To configure BGPaaS using VNC APIs:</p><ol type="1"><li id="jd0e156" style="">Access the default project. <p><code class="inline" v-pre="">default_project = self._vnc_lib.project_read(fq_name=[u'default-domain',
‘bgpaas-tenant’])</code></p></li><li id="jd0e162" style="">Create a BGPaaS object.<p><code class="inline" v-pre="">bgpaas_obj = BgpAsAService(name=‘bgpaas_1’,
parent_obj=default_project)</code></p></li><li id="jd0e168" style="">Attach the BGP object to a precreated virtual machine
interface.<p><code class="inline" v-pre="">bgpaas_obj.add_virtual_machine_interface(vmi)</code></p></li><li id="jd0e174" style="">Set the ASN. It must be an eBGP session.   <p><code class="inline" v-pre="">bgpaas_obj.set_autonomous_system('65000') </code></p><p>If the ASN is not set, the primary instance IP will be chosen.</p><p><code class="inline" v-pre="">bgpaas_obj.set_bgpaas_ip_address(u’10.1.1.5’)</code></p></li><li id="jd0e185" style="">Set session attributes.<p><code class="inline" v-pre="">bgp_addr_fams = AddressFamilies(['inet’,
‘inet6’]) <br/>bgp_sess_attrs = BgpSessionAttributes(address_families=bgp_addr_fams,hold_time=60) <br/>bgpaas_obj.set_bgpaas_session_attributes(bgp_sess_attrs)
 <br/>self._vnc_lib.bgp_as_a_service_create(bgpaas_obj)</code></p></li></ol><p>To delete a BGPaaS object, follow the given code:</p><p><code class="inline" v-pre="">fq_name=[u'default-domain', ‘bgpaas-tenant’,
‘bgpaas_1’] <br/>bgpaas_obj = self._vnc_lib.bgp_as_a_service_read(fq_name=fq_name) <br/>bgpaas_obj.del_virtual_machine_interface(vmi) <br/>self._vnc_lib.bgp_as_a_service_update(bgpaas_obj) <br/>self._vnc_lib.bgp_as_a_service_delete(id=bgpaas_obj.get_uuid())</code></p><h2 id="id-configuring-bgpaas-from-contrail-user-interface">Configuring BGPaaS from Contrail Web UI</h2><p>To configure BGPaaS within a tenant:</p><ol type="1"><li id="jd0e225" style="">Select <strong v-pre="">Configure &gt; Services &gt; BGP as a Service</strong> from the Contrail Web User Interface (UI). The BGP as a Service
page is displayed.</li><li id="jd0e231" style="">Click the <strong v-pre="">+</strong> button on the <strong v-pre="">BGPaaS</strong> page. The <strong v-pre="">Create BGP as a Service</strong> page is displayed.
See <a href="bgpaas-contrail.html#bgpaas-webui">Figure 2</a>.<figure id="bgpaas-webui"><figcaption>Figure 2: Create BGP as a Service</figcaption><div class="graphic"><img alt="Create BGP as a Service" src="documentation/images/S018555.png" style=""/></div></figure></li><li id="jd0e249" style="">In the <strong v-pre="">Create BGPaaS</strong> page, populate the fields
with the following values to create your service.<sw-table><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Fields </p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Name</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a name for the BGP service The name can be a unique
string of not more than 15 characters that contains alphanumeric characters
and hyphen (-).</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">IP Address</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the IPv4 or IPv6 source-address on the BGPaaS VM. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Virtual Machine Interface</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter IP address of a virtual machine interface.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Address Family</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Choose inet or inet6 from the Address Family list according
to your requirement.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Autonomous System</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter AS number in the range 1- 65,534.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><kbd class="user-typing" v-pre="">Advanced Options</kbd></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"> </td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hold Time</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the maximum time a BGP session remains active if
no Keepalives are received.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Admin State</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select the <strong v-pre="">Admin state</strong> box to enable the state
as UP and deselect the box to disable the state to DOWN.</p></td></tr></tbody></table></sw-table></li><li id="jd0e333" style="">Click <strong v-pre="">Save</strong> to create the BGP object.</li></ol><h2 id="id-configuring-bgpaas-from-contrail-command">Configuring BGPaaS from Contrail Command</h2><p>To configure BGPaaS within a tenant:</p><ol type="1"><li id="jd0e352" style=""> Select <strong v-pre="">Services &gt; BGPaaS. </strong> from the Contrail
Command user interface (UI). The BGPaaS page is displayed.</li><li id="jd0e358" style="">Click the <strong v-pre="">Create</strong> button on the <strong v-pre="">BGPaaS</strong> page. The <strong v-pre="">Create BGPaaS</strong> page is displayed. See <a href="bgpaas-contrail.html#bgpass-create">Figure 3</a>.<figure id="bgpass-create"><figcaption>Figure 3: Create BGPaaS</figcaption><div class="graphic"><img alt="Create BGPaaS" src="documentation/images/s008077.PNG" style=""/></div></figure></li><li id="jd0e376" style="">In the <strong v-pre="">Create BGPaaS</strong> page, populate the fields
with the following values to create your BGP object.<sw-table><table cellspacing="0" style="border-top:thin solid black;" width="99%"><thead><tr valign="bottom"><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Fields </p></th><th align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Description</p></th></tr></thead><tbody><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Name</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter a name for the BGP service. The name can be a unique
string of not more than 15 characters that contains alphanumeric characters
and hyphen (-).</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Virtual Machine Interface</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter IP address of a virtual machine interface.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Address Family</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Choose inet or inet6 from the Address Family list according
to your requirement.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Autonomous System</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter autonomous system (AS) number in the range of 1-65,535.</p><p>If you enable <strong v-pre="">4 Byte ASN</strong> in <strong v-pre="">Global Config</strong>, you can enter 4-byte AS number in the range of 1-4,294,967,295.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><kbd class="user-typing" v-pre="">Advanced Options</kbd></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"> </td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">IP Address</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the IPv4 or IPv6 source-address on the BGPaaS VM. </p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Shared</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select this check box to link all VMIs with the common
bgp-router object. If this box is not selected, each virtual machine
interface individually links to its own bgp-router object.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Route Origin</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><ul><li style=""><p>Choose BGP from the list if the route originated on a
BGP router. </p></li><li style=""><p>Choose EGP from the list if the route originated from
an External Gateway Protocols (EGP) session.</p></li><li style=""><p>Choose Incomplete from the list if the Network Layer Reachability
Information (NLRI) is learned through methods such as redistribution
of the routes into BGP, and not through BGP.</p></li></ul></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Route Origin Override</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select this check box to override the origin attribute
of the advertised route origin into Incomplete.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Service Health Check</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select any Service Health Check object from the list
according to your requirement.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Hold Time</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the maximum time a BGP session remains active if
no Keepalives are received.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Loop Count</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter the number of times the same ASN can be seen in
a route-update. The route is discarded when the loop count is exceeded.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Local ASN</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Enter autonomous system (AS) number in the range of 1-65,535.</p><p>If you enable <strong v-pre="">4 Byte ASN</strong> in <strong v-pre="">Global Config</strong>, you can enter 4-byte AS number in the range of 1-4,294,967,295.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">AS Override</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select this check box to replace the AS number of the
control node with the AS number of the tenant VM.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Use IPv4-mapped IPv6 Nexthop</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select this check box to use IPv4-mapped IPv6 format
as the next hop instead of the IPv4 subnet's default gateway.   </p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Suppress Route Advertisement</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>Select this check box to prevent advertisement of routes
to tenant VM.</p></td></tr><tr valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Primary Control Node Zone</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>You can choose the control-node with which the BGPaaS
VM can perform a BGP session.</p></td></tr><tr class="row-with-bg" valign="top"><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p><strong v-pre="">Secondary Control Node Zone</strong></p></td><td align="left" style="border-bottom:thin solid black;text-align: left;padding-right: 10px;padding-left: 10px;"><p>You can choose the control-node with which the BGPaaS
VM can perform a BGP session. </p></td></tr></tbody></table></sw-table></li><li id="jd0e562" style="">Click the <strong v-pre="">Create</strong> button to create the BGP object.</li></ol><sw-prev-next> </sw-prev-next></p>